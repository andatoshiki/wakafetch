version: 2

before:
  hooks:
    - go mod tidy

git:
  ignore_tags:
    - "{{ if not .IsNightly }}*-rc*{{ end }}"

builds:
  - id: wakafetch
    binary: wakafetch
    env:
      - CGO_ENABLED=0
    tags:
      - netgo
      - osusergo
    goos:
      - linux
      - windows
      - darwin
      - freebsd
      - openbsd
      - netbsd
      - dragonfly
      - solaris
    goarch:
      - amd64
      - 386
      - arm
      - arm64
      - mips
      - mipsle
      - mips64
      - mips64le
      - ppc64
      - ppc64le
      - riscv64
      - s390x
    goarm:
      - "6"
      - "7"
    gomips:
      - hardfloat
      - softfloat
    ignore:
      # Darwin: only amd64 and arm64
      - goos: darwin
        goarch: arm
      - goos: darwin
        goarch: 386
      - goos: darwin
        goarch: mips
      - goos: darwin
        goarch: mipsle
      - goos: darwin
        goarch: mips64
      - goos: darwin
        goarch: mips64le
      - goos: darwin
        goarch: ppc64
      - goos: darwin
        goarch: ppc64le
      - goos: darwin
        goarch: riscv64
      - goos: darwin
        goarch: s390x
      # Windows: amd64, 386, arm64 (no 32-bit arm)
      - goos: windows
        goarch: arm
      - goos: windows
        goarch: mips
      - goos: windows
        goarch: mipsle
      - goos: windows
        goarch: mips64
      - goos: windows
        goarch: mips64le
      - goos: windows
        goarch: ppc64
      - goos: windows
        goarch: ppc64le
      - goos: windows
        goarch: riscv64
      - goos: windows
        goarch: s390x
      # Dragonfly: amd64 only
      - goos: dragonfly
        goarch: 386
      - goos: dragonfly
        goarch: arm
      - goos: dragonfly
        goarch: arm64
      - goos: dragonfly
        goarch: mips
      - goos: dragonfly
        goarch: mipsle
      - goos: dragonfly
        goarch: mips64
      - goos: dragonfly
        goarch: mips64le
      - goos: dragonfly
        goarch: ppc64
      - goos: dragonfly
        goarch: ppc64le
      - goos: dragonfly
        goarch: riscv64
      - goos: dragonfly
        goarch: s390x
      # Solaris/Illumos: amd64 only
      - goos: solaris
        goarch: 386
      - goos: solaris
        goarch: arm
      - goos: solaris
        goarch: arm64
      - goos: solaris
        goarch: mips
      - goos: solaris
        goarch: mipsle
      - goos: solaris
        goarch: mips64
      - goos: solaris
        goarch: mips64le
      - goos: solaris
        goarch: ppc64
      - goos: solaris
        goarch: ppc64le
      - goos: solaris
        goarch: riscv64
      - goos: solaris
        goarch: s390x

archives:
  - id: wakafetch
    name_template: >-
      wakafetch-
      {{- if eq .Os "darwin" }}darwin{{- else if eq .Os "linux" }}linux{{- else if eq .Os "windows" }}windows{{- else if eq .Os "freebsd" }}freebsd{{- else if eq .Os "openbsd" }}openbsd{{- else if eq .Os "netbsd" }}netbsd{{- else if eq .Os "dragonfly" }}dragonfly{{- else if eq .Os "solaris" }}solaris{{- else }}{{ .Os }}{{ end }}-
      {{- if eq .Arch "amd64" }}x86-64{{- else if eq .Arch "386" }}i386{{- else if eq .Arch "arm64" }}aarch64{{- else if eq .Arch "arm" }}armv{{ .Arm }}{{- else if eq .Arch "mips" }}mips{{- if .Mips }}-{{ .Mips }}{{ end }}{{- else if eq .Arch "mipsle" }}mipsle{{- if .Mips }}-{{ .Mips }}{{ end }}{{- else if eq .Arch "mips64" }}mips64{{- if .Mips }}-{{ .Mips }}{{ end }}{{- else if eq .Arch "mips64le" }}mips64le{{- if .Mips }}-{{ .Mips }}{{ end }}{{- else if eq .Arch "ppc64" }}ppc64{{- else if eq .Arch "ppc64le" }}ppc64le{{- else if eq .Arch "riscv64" }}riscv64{{- else if eq .Arch "s390x" }}s390x{{- else }}{{ .Arch }}{{ end }}-
      {{- .Version }}
    format_overrides:
      - goos: windows
        format: zip
    files:
      - readme.md

checksum:
  name_template: checksums.txt

snapshot:
  version_template: "{{ incpatch .Version }}-next"

changelog:
  disable: true

release:
  prerelease: auto
  header: |
    wakafetch {{ .Version }}
    Binaries attached.
